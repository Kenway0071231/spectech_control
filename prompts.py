"""
Промпты для ИИ-модулей бота ТехКонтроль
"""

# ========== ПРОМПТ ДЛЯ АНАЛИЗА ДОКУМЕНТОВ СТС/ПТС ==========
DOCUMENT_ANALYSIS_PROMPT = """
Ты - эксперт по автомобильным документам. Проанализируй изображение документа на транспортное средство.

ИЗВЛЕКИ ДАННЫЕ В JSON ФОРМАТЕ:
{
  "document_type": "СТС/ПТС/ПСМ",
  "vin": "VIN номер",
  "registration_number": "Госномер",
  "model": "Модель",
  "brand": "Марка",
  "year": "Год выпуска",
  "category": "Категория ТС",
  "engine_power": "Мощность двигателя (л.с.)",
  "engine_volume": "Объем двигателя (см³)",
  "color": "Цвет",
  "weight": "Масса (кг)",
  "max_weight": "Максимальная масса (кг)",
  "owner": "Собственник",
  "passport_number": "Номер паспорта ТС",
  "registration_date": "Дата регистрации",
  "engine_number": "Номер двигателя",
  "chassis_number": "Номер шасси",
  "body_number": "Номер кузова",
  "environmental_class": "Экологический класс",
  "extracted_text": "Полный текст с документа"
}

ПРАВИЛА:
1. Если поле не найдено - используй "null"
2. VIN должен быть 17 символов
3. Госномер в формате с русскими буквами
4. Год выпуска - 4 цифры
5. Мощность - число в л.с.
6. Цвет на русском языке
7. Все текстовые поля на русском языке
8. Только JSON, без пояснений

ВАЖНО: Извлеки весь текст, затем проанализируй и заполни JSON.
"""

# ========== ПРОМПТ ДЛЯ РЕГИСТРАЦИИ ТЕХНИКИ ==========
REGISTRATION_PROMPT = """
Ты - помощник по регистрации спецтехники. На основе данных из документа сформируй информацию для регистрации.

ИСХОДНЫЕ ДАННЫЕ:
{document_data}

ФОРМАТ ОТВЕТА (JSON):
{
  "equipment_name": "Предлагаемое название",
  "equipment_type": "Тип техники",
  "missing_fields": ["список отсутствующих полей"],
  "recommendations": "Рекомендации"
}
"""

# ========== ПРОМПТ ДЛЯ ВИЗУАЛЬНОГО АНАЛИЗА ==========
VISION_ANALYSIS_PROMPT = """
Ты анализируешь текст из изображения автомобильного документа.
Извлеки информацию в формате JSON:
1. Номерные данные (VIN, госномер)
2. Основные характеристики (марка, модель, год, цвет)
3. Технические параметры (мощность, объем, масса)
4. Данные о регистрации
5. Данные о собственнике

Если данные отсутствуют - укажи "null".
"""

# ========== ПРОМПТ ДЛЯ КЛАССИФИКАЦИИ ДОКУМЕНТОВ ==========
DOCUMENT_CLASSIFICATION_PROMPT = """
Определи тип документа:
1. СТС - Свидетельство о регистрации
2. ПТС - Паспорт транспортного средства
3. ПСМ - Паспорт самоходной машины
4. ДРУГОЙ - Иной документ

Верни только тип документа.
"""

# ========== ПРОМПТ ДЛЯ ОБРАБОТКИ ОШИБОК ==========
ERROR_CORRECTION_PROMPT = """
Ты исправляешь ошибки в распознанных данных.

ИСХОДНЫЕ ДАННЫЕ (с ошибками):
{raw_data}

ПРАВИЛА ИСПРАВЛЕНИЯ:
1. VIN: ровно 17 символов, буквы A-Z и цифры 0-9
2. Госномер: формат X000XX00 (русские буквы)
3. Год: 4 цифры, между 1950 и текущим годом
4. Мощность: число в л.с.
5. Цвет: стандартные цвета на русском

Верни исправленный JSON.
"""

# ========== ПРОМПТ ДЛЯ ФОРМИРОВАНИЯ СООБЩЕНИЯ ==========
MESSAGE_FORMATTING_PROMPT = """
Отформатируй данные о технике для отправки пользователю:

ДАННЫЕ:
{data}

Создай понятное сообщение на русском языке.
"""

# Словарь всех промптов
PROMPTS = {
    "document_analysis": DOCUMENT_ANALYSIS_PROMPT,
    "registration": REGISTRATION_PROMPT,
    "vision_analysis": VISION_ANALYSIS_PROMPT,
    "document_classification": DOCUMENT_CLASSIFICATION_PROMPT,
    "error_correction": ERROR_CORRECTION_PROMPT,
    "message_formatting": MESSAGE_FORMATTING_PROMPT,
}

def get_prompt(prompt_name: str, **kwargs) -> str:
    """Получить промпт по имени с подстановкой значений"""
    prompt = PROMPTS.get(prompt_name, "")
    if kwargs:
        try:
            prompt = prompt.format(**kwargs)
        except KeyError:
            pass
    return prompt
